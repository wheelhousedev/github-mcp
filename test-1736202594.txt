
> github-manager@0.1.0 test
> vitest run


 RUN  v2.1.8 /Users/dustmoo/Documents/Cline/MCP/github-manager

 ❯ build/test/unit/services/organizations/ListOrgsService.test.js (4 tests | 1 failed) 8ms
   × ListOrgsService > execute > should handle rate limit errors 3ms
     → expected "spy" to be called at least once
 ❯ build/test/integration/GitHubManager.test.js (0 test)
 ❯ build/test/unit/GitHubManager.test.js (0 test)
 ❯ test/unit/services/repositories/ListReposService.test.ts (5 tests | 5 failed) 10ms
   × ListReposService > execute > should list repositories successfully 5ms
     → expected "spy" to be called with arguments: [ [ 'read:org', 'repo' ] ]

Received: 

  1st spy call:

  Array [
    Array [
-     "read:org",
      "repo",
    ],
  ]


Number of calls: 1

   × ListReposService > execute > should handle missing organization parameter 2ms
     → expected Error: MCP error -32602: Organization nam… { …(2) } to match object { code: -32603, …(2) }
(2 matching properties omitted from actual)
   × ListReposService > execute > should handle authentication errors 1ms
     → expected "spy" to be called with arguments: [ 'Access verification failed', …(1) ]

Received: 

  1st spy call:

  Array [
    "Access verification failed",
-   ObjectContaining {
+   Object {
+     "error": "Bad credentials",
      "required_scopes": Array [
-       "read:org",
        "repo",
      ],
    },
  ]


Number of calls: 1

   × ListReposService > execute > should handle rate limit errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
   × ListReposService > execute > should handle network errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
(2 matching properties omitted from actual)
 ❯ test/unit/services/repositories/CreateRepoService.test.ts (7 tests | 5 failed) 11ms
   × CreateRepoService > execute > should create a public repository successfully 5ms
     → expected { name: 'new-repo', …(7) } to deeply equal { name: 'new-repo', …(4) }
   × CreateRepoService > execute > should create a private repository successfully 1ms
     → expected { name: 'new-repo', …(7) } to deeply equal { name: 'new-repo', …(4) }
   × CreateRepoService > execute > should handle missing required parameters 2ms
     → expected Error: MCP error -32602: Organization and… { …(2) } to match object { code: -32603, …(2) }
(2 matching properties omitted from actual)
   × CreateRepoService > execute > should handle rate limit errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
   × CreateRepoService > execute > should handle network errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
(5 matching properties omitted from actual)
 ❯ test/unit/services/organizations/ListOrgsService.test.ts (4 tests | 3 failed) 12ms
   × ListOrgsService > execute > should list organizations successfully 6ms
     → expected [ { name: undefined, …(4) } ] to have a length of 2 but got 1
   × ListOrgsService > execute > should handle rate limit errors 3ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
(8 matching properties omitted from actual)
   × ListOrgsService > execute > should handle network errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
 ❯ test/unit/services/repositories/UpdateRepoSettingsService.test.ts (7 tests | 5 failed) 11ms
   × UpdateRepoSettingsService > execute > should update repository settings successfully 5ms
     → expected { name: 'test-repo', …(1) } to deeply equal { name: 'test-repo', …(1) }
   × UpdateRepoSettingsService > execute > should handle partial settings updates 1ms
     → expected { name: 'test-repo', …(1) } to deeply equal { name: 'test-repo', …(1) }
   × UpdateRepoSettingsService > execute > should handle missing required parameters 2ms
     → expected Error: MCP error -32603: Organization, re… { …(2) } to match object { code: -32603, …(2) }
(2 matching properties omitted from actual)
   × UpdateRepoSettingsService > execute > should handle rate limit errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
   × UpdateRepoSettingsService > execute > should handle network errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
(5 matching properties omitted from actual)
 ❯ test/unit/services/collaborators/AddCollaboratorService.test.ts (8 tests | 5 failed) 14ms
   × AddCollaboratorService > execute > should add collaborator successfully 5ms
     → expected { status: 'active', …(2) } to deeply equal { status: 'active', …(1) }
   × AddCollaboratorService > execute > should handle missing required parameters 2ms
     → promise resolved "{ status: 'active', …(2) }" instead of rejecting
   × AddCollaboratorService > execute > should handle invalid permission level 1ms
     → promise resolved "{ status: 'active', …(2) }" instead of rejecting
   × AddCollaboratorService > execute > should handle rate limit errors 2ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
   × AddCollaboratorService > execute > should handle network errors 1ms
     → expected Error: Bad credentials { …(2) } to match object { code: -32603, …(2) }
(5 matching properties omitted from actual)

 Test Files  8 failed (8)
      Tests  24 failed | 11 passed (35)
   Start at  14:30:03
   Duration  467ms (transform 829ms, setup 0ms, collect 961ms, tests 67ms, environment 1ms, prepare 958ms)

